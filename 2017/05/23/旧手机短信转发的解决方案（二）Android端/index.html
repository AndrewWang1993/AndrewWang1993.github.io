
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="AndrewWang&#39;s Blog">
    <title>旧手机短信转发的解决方案（二）Android端 - AndrewWang&#39;s Blog</title>
    <meta name="author" content="AndrewWang">
    
        <meta name="keywords" content="hexo,javascript,android,java,JS,Python,">
    
    
        <link rel="icon" href="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/favicon(8).png">
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"AndrewWang","sameAs":["https://github.com/AndrewWang1993","https://stackoverflow.com/users/4209302/andrewwang","mailto:fernando_caudill@outlook.com"],"image":"https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/avatar(7).png"},"articleBody":"可以转发所接收到短信的Android App\n代码结构\n\nShortMessageBean.java (短消息实体类)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263public class ShortMessageBean &#123;    private String content;    private String obsContent;    private int currentCount;    private int msgId;    public ShortMessageBean(String content, String obsContent, int currentCount, int msgId) &#123;        this.content = content;        this.obsContent = obsContent;        this.currentCount = currentCount;        this.msgId = msgId;    &#125;    public ShortMessageBean(String content, String obsContent) &#123;        this.content = content;        this.obsContent = obsContent;        this.currentCount = SMSAplication.MAX_RETRY_COUNT;        this.msgId = new Random().nextInt(Integer.MAX_VALUE);    &#125;    public String getContent() &#123;        return content;    &#125;    public void setContent(String content) &#123;        this.content = content;    &#125;    public String getObsContent() &#123;        return obsContent;    &#125;    public void setObsContent(String obsContent) &#123;        this.obsContent = obsContent;    &#125;    public int getCurrentCount() &#123;        return currentCount;    &#125;    public void setCurrentCount(int currentCount) &#123;        this.currentCount = currentCount;    &#125;    public int getMsgId() &#123;        return msgId;    &#125;    public void setMsgId(int msgId) &#123;        this.msgId = msgId;    &#125;    @Override    public String toString() &#123;        return \"ShortMessageBean&#123;\" +                \"content='\" + content + '\\'' +                \", obsContent='\" + obsContent + '\\'' +                \", currentCount=\" + currentCount +                \", msgId=\" + msgId +                '&#125;';    &#125;&#125;\nMainActivity.java（主程序）123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424public class MainActivity extends Activity &#123;    Button mButtonClear;    Button mButtonSend;    TextView mSMSlogTextView;    EditText mEditText;    BroadcastReceiver mSMCommingReceiver, mScreenReceiver, mBatteryReceiver;    IntentFilter mSMSIntentFilter, mScreenIntentFilter, mBatteryFilter;    int currentDay = Calendar.getInstance().get(Calendar.DAY_OF_MONTH);    SimpleDateFormat mSimpleDateFormat = new SimpleDateFormat(\"HH:mm:ss\", Locale.getDefault());    private static final int MSG_NET_SEND = 1;    private static final int MSG_SMS_SEND = 2;    @SuppressLint(\"HandlerLeak\")    Handler mHandler = new Handler() &#123;        @Override        public void handleMessage(Message msg) &#123;            final ShortMessageBean shortMessageBean = (ShortMessageBean) msg.obj;            final int currentCount = shortMessageBean.getCurrentCount();            final String content = shortMessageBean.getContent();            final String obsContent = shortMessageBean.getObsContent();            Logger.i(\"MESSAGE ID --&gt;\" + shortMessageBean.getMsgId());            switch (msg.what) &#123;                case MSG_NET_SEND:                    ArrayMap&lt;String, String&gt; params = new ArrayMap&lt;&gt;();                    params.put(\"msg\", obsContent);                    RequestBody body = RequestBody.create(JSON, new JSONObject(params).toString());                    //避免重试时堆栈中还有此URL请求                    String randomURL = SERVER_URL + \"?id=\" + (new Random().nextInt(9999999) + 1);                    Request request = new Request.Builder()                            .url(randomURL)                            .post(body)                            .build();                    client.newCall(request).enqueue(new okhttp3.Callback() &#123;                        @Override                        public void onResponse(Call call, Response response) throws IOException &#123;                            if (response.isSuccessful()) &#123;                                try &#123;                                    JSONObject rspJson = new JSONObject(response.body().string());                                    final String divider;                                    String rspStr = rspJson.optString(\"rsp\");                                    if (rspStr.contains(\"200\")) &#123;                                        divider = NORMAL_DIVIDER;                                    &#125; else &#123;                                        divider = ABNORMAL_DIVIDER;                                    &#125;                                    Logger.i(\"SEND --&gt;\" + content);                                    //该回调不在主线程                                    MainActivity.this.runOnUiThread(new Runnable() &#123;                                        @Override                                        public void run() &#123;                                            checkClearScreen();                                            addTextViewMessage(mSMSlogTextView, divider +                                                    mSimpleDateFormat.format(new Date()) + \"--&gt;  \" + content);                                        &#125;                                    &#125;);                                &#125; catch (JSONException e) &#123;                                    Logger.e(\"服务器返回Json格式异常\");                                    e.printStackTrace();                                &#125;                            &#125; else &#123;                                Logger.e(\"服务器返回异常\");                            &#125;                        &#125;                        @Override                        public void onFailure(Call call, IOException e) &#123;                            Logger.e(\"请求失败 \" + e.toString());                            if (currentCount &gt; 0) &#123;                                //如果网络已连接但是不通，尝试进行4G/WIFI切换                                if ((currentCount == 3) &amp;&amp; !ConnectivityUtils.isOnline2()) &#123;                                    Logger.e(\"NO NETWORK--&gt; COUNT \" + currentCount);                                    Logger.e(\"NO NETWORK--&gt;  try toggle wifi\");                                    ConnectivityUtils.toggleWifi();                                &#125;                                Logger.e(\"ERROR COUNT: \" + currentCount);                                int delayTime = (MAX_RETRY_COUNT - currentCount) * RETRY_INTERVAL;                                shortMessageBean.setCurrentCount(currentCount - 1);                                send(MSG_NET_SEND, delayTime, shortMessageBean);                            &#125; else &#123;                                send(MSG_SMS_SEND, shortMessageBean);                            &#125;                        &#125;                    &#125;);                    break;                case MSG_SMS_SEND:                    sendByPhone(content);                    break;                default:                    break;            &#125;        &#125;    &#125;;    @Override    protected void onCreate(Bundle savedInstanceState) &#123;        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        setAllowNetWorkMainThread();        Logger.d(\"MainActivity CREATE\");        mButtonClear = (Button) findViewById(R.id.button_clear);        mButtonSend = (Button) findViewById(R.id.button_send);        mSMSlogTextView = (TextView) findViewById(R.id.smsLogTextView);        mSMSlogTextView.setMovementMethod(new ScrollingMovementMethod());        mEditText = (EditText) findViewById(R.id.edit_text);        mButtonClear.setOnLongClickListener(new View.OnLongClickListener() &#123;            @Override            public boolean onLongClick(View v) &#123;                boolean isInputBarVisible = mEditText.getVisibility() == View.VISIBLE;                mEditText.setVisibility(isInputBarVisible ? View.GONE : View.VISIBLE);                if (!isInputBarVisible) &#123;                    mEditText.setText(SERVER_HOST + \":\" + SERVER_PORT);                    return false;                &#125;                String url = mEditText.getText().toString().trim();                if (!TextUtils.isEmpty(url)) &#123;                    if (!url.contains(\"http\")) &#123;                        Toast.makeText(getApplicationContext(), \"必须含有http或者https\", Toast.LENGTH_SHORT).show();                        return false;                    &#125;                    String[] urlSplit = url.split(\":\");                    if (urlSplit.length == 2) &#123;                        SERVER_HOST = url;                        SERVER_PORT = 58585;                    &#125; else if (urlSplit.length == 3) &#123;                        SERVER_HOST = urlSplit[0] + \":\" + urlSplit[1];                        SERVER_PORT = Integer.valueOf(urlSplit[2]);                    &#125; else &#123;                        Toast.makeText(getApplicationContext(), \"URL不合法\", Toast.LENGTH_SHORT).show();                        return false;                    &#125;                &#125; else &#123;                    SERVER_HOST = SERVER_FIX_HOST;                    SERVER_PORT = 58585;                &#125;                SERVER_URL = SERVER_HOST + \":\" + SERVER_PORT + SERVER_PATH;                SPStaticUtils.put(TAG_URL, SERVER_URL);                SPStaticUtils.put(TAG_HOST, SERVER_HOST);                SPStaticUtils.put(TAG_PORT, SERVER_PORT);                if (mEditText.getVisibility() == View.GONE) &#123;                    Toast.makeText(mApplication, SERVER_URL + \" 已生效\", Toast.LENGTH_LONG).show();                &#125;                return false;            &#125;        &#125;);        mButtonSend.setOnLongClickListener(new View.OnLongClickListener() &#123;            @Override            public boolean onLongClick(View v) &#123;//                SERVER_HOST = SERVER_FIX_HOST;//                SERVER_PORT = 58585;//                SERVER_URL = SERVER_HOST + \":\" + SERVER_PORT + SERVER_PATH;//                Toast.makeText(mApplication, SERVER_URL + \"已重置服务器地址\", Toast.LENGTH_SHORT).show();                toggleServer(false);                finish();                android.os.Process.killProcess(android.os.Process.myPid());                return false;            &#125;        &#125;);        setBrocastReceiver();        setIntentFilter();        toggleServer(true);    &#125;    @Override    protected void onStart() &#123;        super.onStart();        PhoneCallReceiver.setOnRingListener(new PhoneCallReceiver.OnRingListener() &#123;            @Override            public void onIncomingCallReceived(Context ctx, String number, Date start) &#123;                sendIncomingRingMsg(number.replace(\"+\", \"\").replace(\"-\", \"\").replace(\" \", \"\"));            &#125;        &#125;);    &#125;    @Override    protected void onResume() &#123;        super.onResume();        Logger.i(\"MainActivity RESUME\");        registerReceiver(mSMCommingReceiver, mSMSIntentFilter);        registerReceiver(mScreenReceiver, mScreenIntentFilter);        registerReceiver(mBatteryReceiver, mBatteryFilter);    &#125;    @Override    protected void onDestroy() &#123;        super.onDestroy();        Logger.i(\"MainActivity DESTORY\");        unregisterReceiver(mSMCommingReceiver);        unregisterReceiver(mScreenReceiver);        unregisterReceiver(mBatteryReceiver);    &#125;    private void setBrocastReceiver() &#123;        mSMCommingReceiver = new BroadcastReceiver() &#123;            @Override            public void onReceive(Context context, Intent intent) &#123;                String msg_from = \"\";                StringBuilder msgBodyStringBuilder = new StringBuilder(200);                Bundle bundle = intent.getExtras();                SmsMessage[] msgs;                if (bundle != null) &#123;                    try &#123;                        Object[] pdus = (Object[]) bundle.get(\"pdus\");                        assert pdus != null;                        msgs = new SmsMessage[pdus.length];                        for (int i = 0; i &lt; msgs.length; i++) &#123;                            msgs[i] = SmsMessage.createFromPdu((byte[]) pdus[i]);                            msg_from = msgs[i].getOriginatingAddress();                            msgBodyStringBuilder.append(msgs[i].getMessageBody());                        &#125;                        String name = SMSAplication.sPhoneContactMap                                .get(msg_from.replace(\"+\", \"\").replace(\"-\", \"\").replace(\" \", \"\"));                        if (!TextUtils.isEmpty(name)) &#123;                            msgBodyStringBuilder.insert(0, name + \"-&gt; \");                        &#125;                        String content = msg_from + \"\\n\" + msgBodyStringBuilder.toString();                        //回应飞信消息                        if (content.contains(\"%YG8Cf^17R*GqzVfxXHP2e\") &amp;&amp; content.contains(\"查询手机状态信息\")) &#123;                            sendStatusMsg();                            return;                        &#125;                        if (content.contains(\"s*Yfb3SdXy9ruUBK8R!gZX\") &amp;&amp; content.contains(\"设置网络\")) &#123;                            setNetMsg(content);                            return;                        &#125;                        send(MSG_NET_SEND,                                new ShortMessageBean(content, EncryptUtils.encrypt(msg_from, msgBodyStringBuilder.toString())));                    &#125; catch (Exception e) &#123;                        Logger.e(e.getMessage());                    &#125;                &#125;            &#125;        &#125;;        mScreenReceiver = new BroadcastReceiver() &#123;            @Override            public void onReceive(Context context, Intent intent) &#123;                Logger.i(intent.getAction());                if (intent.getAction().equals(Intent.ACTION_SCREEN_OFF)) &#123;                    Intent starKeepActivityIntent = new Intent(MainActivity.this, KeepLiveActivity.class);                    startActivity(starKeepActivityIntent);                &#125;            &#125;        &#125;;        mBatteryReceiver = new BroadcastReceiver() &#123;            @Override            public void onReceive(Context context, Intent batteryIntent) &#123;                Logger.i(batteryIntent.getAction());                if (batteryIntent.getAction().equals(Intent.ACTION_BATTERY_LOW)) &#123;                    sendStatusMsg();                &#125;            &#125;        &#125;;    &#125;    private void setNetMsg(String msg) &#123;        String msg_from = \"66666666\";        String msgBodyString = \"设置网络 \";        if (msg.contains(\"4G\")) &#123;            msgBodyString += \"4G\";            ConnectivityUtils.setWifi(false);        &#125; else if (msg.contains(\"WIFI\")) &#123;            msgBodyString += \"WIFI\";            ConnectivityUtils.setWifi(true);        &#125; else &#123;            msgBodyString += \"NONE\";        &#125;        String content = msg_from + \"\\n\" + msgBodyString;        Logger.i(content);        send(MSG_NET_SEND,                new ShortMessageBean(content, EncryptUtils.encrypt(msg_from, msgBodyString)));    &#125;    private void sendStatusMsg() &#123;        String msg_from = \"88888888\";        String msgBodyString = \"当前电量 \" + CommonUtils.getBatteryLevel() + \" %\";        msgBodyString += \"\\n网络信息 \" + ConnectivityUtils.getConnectedInfo(SMSAplication.mApplication);        msgBodyString += \"\\n连通信息 \" + ConnectivityUtils.isOnline2();        String content = msg_from + \"\\n\" + msgBodyString;        Logger.i(content);        send(MSG_NET_SEND,                new ShortMessageBean(content, EncryptUtils.encrypt(msg_from, msgBodyString)));    &#125;    private void sendIncomingRingMsg(String number) &#123;        String msg_from = number;        String msgBodyString = \"【来电提醒】 \" + number;        String name = SMSAplication.sPhoneContactMap.get(number);        if (!TextUtils.isEmpty(name)) &#123;            msgBodyString = \"【来电提醒】-&gt;\" + name;        &#125;        String content = msg_from + \"\\n\" + msgBodyString;        Logger.i(content);        send(MSG_NET_SEND,                new ShortMessageBean(content, EncryptUtils.encrypt(msg_from, msgBodyString)));    &#125;    private void setIntentFilter() &#123;        mSMSIntentFilter = new IntentFilter(\"android.provider.Telephony.SMS_RECEIVED\");        mSMSIntentFilter.setPriority(1000);        mScreenIntentFilter = new IntentFilter(Intent.ACTION_SCREEN_OFF);        mScreenIntentFilter.setPriority(1000);        mBatteryFilter = new IntentFilter(Intent.ACTION_BATTERY_LOW);        mBatteryFilter.setPriority(1000);    &#125;    private void toggleServer(boolean start) &#123;        Intent serverIntent = new Intent(getApplicationContext(), KeepLiveServer.class);        serverIntent.putExtra(\"status\", start ? \"start\" : \"stop\");        startService(serverIntent);    &#125;    private void send(int what, ShortMessageBean shortMessageBean) &#123;        Message message = mHandler.obtainMessage(what);        message.obj = shortMessageBean;        message.sendToTarget();    &#125;    private void send(int what, int delay, ShortMessageBean shortMessageBean) &#123;        Message message = new Message();        message.what = what;        message.obj = shortMessageBean;        mHandler.sendMessageDelayed(message, delay);    &#125;    /**     * 由本机发送     *     * @param content sms content     */    synchronized private void sendByPhone(String content) &#123;        int nowDay = Calendar.getInstance().get(Calendar.DAY_OF_MONTH);        if (nowDay != SMSAplication.sCurrentDay) &#123;            SMSAplication.sSMSByPhoneTodayCount = 0;            SMSAplication.sCurrentDay = nowDay;        &#125;        //如果使用短信，每天发送超过10条        if (SMSAplication.sSMSByPhoneTodayCount &gt; SMSAplication.MAX_SMS_BY_PHONE_COUNT) &#123;            addTextViewMessage(mSMSlogTextView, ABNORMAL_DIVIDER +                    mSimpleDateFormat.format(new Date()) + \"--&gt;  \" + \"使用短信发送超过每日限制 !!!!!!\\n\"                    + content);            Logger.e(\"使用短信发送超过每日限制 : \" + content);            return;        &#125;        // 如果是验证码短信则本机发送        if ((content.contains(\"动态\") || content.contains(\"验证\")) &amp;&amp; (!content.contains(\"Test__\"))) &#123;            if (TextUtils.isEmpty(SMSAplication.sCurrentPhoneNum)) &#123;                CommonUtils.sendLongSMS(SMSAplication.S_PHONE_NUMBER_POOLS[0], content);                addTextViewMessage(mSMSlogTextView, ABNORMAL_DIVIDER +                        mSimpleDateFormat.format(new Date()) + \"--&gt;  \" + \"验证码使用短信发送 !!!!!!\\n\"                        + content);                Logger.e(\"验证码使用短信发送: \" + content);            &#125; else &#123;                for (String num : SMSAplication.S_PHONE_NUMBER_POOLS) &#123;                    if (!SMSAplication.sCurrentPhoneNum.contains(num)) &#123;                        CommonUtils.sendLongSMS(num, content);                        addTextViewMessage(mSMSlogTextView, ABNORMAL_DIVIDER +                                mSimpleDateFormat.format(new Date()) + \"--&gt;  \" + \"验证码使用短信发送 !!!!!!\\n\"                                + content);                        Logger.e(\"验证码使用短信发送: \" + content);                    &#125;                &#125;            &#125;            SMSAplication.sSMSByPhoneTodayCount++;        &#125; else &#123;            addTextViewMessage(mSMSlogTextView, ABNORMAL_DIVIDER +                    mSimpleDateFormat.format(new Date()) + \"--&gt;  \" + \"非验证码不使用短信发送 !!!!!!\\n\"                    + content);            Logger.e(\"非验证码不使用短信发送 : \" + content);        &#125;    &#125;    public void clear(View view) &#123;        mSMSlogTextView.setText(\"\");    &#125;    public void checkClearScreen() &#123;        int nowDay = Calendar.getInstance().get(Calendar.DAY_OF_MONTH);        if (nowDay != currentDay) &#123;            mSMSlogTextView.setText(\"\");            currentDay = nowDay;        &#125;    &#125;    public void stimulateSend(View view) &#123;        String msg_from = TEST_SMS_FROM[new Random().nextInt(TEST_SMS_FROM.length)];        String msgBodyString = TEST_SMS_BODY[new Random().nextInt(TEST_SMS_BODY.length)];        String content = msg_from + \"\\n\" + msgBodyString;        ShortMessageBean shortMessageBean = new ShortMessageBean(content, EncryptUtils.encrypt(msg_from, msgBodyString));        send(MSG_NET_SEND, shortMessageBean);        Toast.makeText(mApplication, \"模拟接收到短信\", Toast.LENGTH_SHORT).show();    &#125;    private void addTextViewMessage(TextView mTextView, String msg) &#123;        mTextView.append(msg);        final int scrollAmount =                mTextView.getLayout().getLineTop(mTextView.getLineCount()) - mTextView.getHeight();        if (scrollAmount &gt; 0)            mTextView.scrollTo(0, scrollAmount);        else            mTextView.scrollTo(0, 0);    &#125;&#125;\nSMSAplication.java1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798public class SMSAplication extends Application &#123;    public static Application mApplication;    public static final String SERVER_FIX_HOST = \"https://m.xiaoo.ml\";    public static String SERVER_HOST = SERVER_FIX_HOST;    public static int SERVER_PORT = 58585;    public static String SERVER_PATH = \"/Cbu8x23asdfwfsae9fJGZ/api/push_sms\";    public static String SERVER_URL = SERVER_HOST + \":\" + SERVER_PORT + SERVER_PATH;    public static String TAG_HOST = \"TAG_HOST\";    public static String TAG_PORT = \"TAG_PORT\";    public static String TAG_URL = \"TAG_URL\";    public static HashMap&lt;String, String&gt; sPhoneContactMap;    public static String sCurrentPhoneNum;    public final static String[] S_PHONE_NUMBER_POOLS = &#123;\"13000000000\", \"13000000001\"&#125;;    public final static int MAX_SMS_BY_PHONE_COUNT = 10;    volatile public static int sSMSByPhoneTodayCount = 0; // 没网状态每天最多发送10条验证码短信    volatile public static int sCurrentDay = Calendar.getInstance().get(Calendar.DAY_OF_MONTH);    public static final int MAX_RETRY_COUNT = 6;    public static final int RETRY_INTERVAL = 2000;    public static final String NORMAL_DIVIDER = \"\\n----------------------------------\\n\";    public static final String ABNORMAL_DIVIDER = \"\\n************************************\\n\";    public static final String TEST_SMS_FROM[] = &#123;            \"10086\", \"10690691036509\", \"10584156\",            \"10086\", \"10690691036509\", \"10584156\"&#125;;    public static final String TEST_SMS_BODY[] = &#123;            \"Test__尊敬的客户：您当前账户余额19.57元，下一个月结日为2017年07月01日。如需充值可点击 http://fj.10086.cn/cz 。【中国移动】\",            \"Test__【百度】588662 (动态验证码),请在30分钟内填写\",            \"Test__【新浪网】感谢您选择新浪云。接下来的日子，我们将全力协助您，并与您携手一起用技术和创意改变世界！，退订回T\",            \"Test__【美团网】506820（换绑手机验证码）。工作人员不会向您索要，请勿向任何人泄露。\",            \"Test__【每日优鲜】&lt;满59减30&gt;红包送你！超级会员周，会员专享商品最高直降30元，还不快抢→ http://t.cn/Ra10SNB 退订TD\",            \"Test__每周五上午10点，持浦发银行卡在食行生鲜APP平台充值并在线支付，即可享受满100元返50元优惠\"&#125;;    public static OkHttpClient client = new OkHttpClient.Builder()            .connectTimeout(6, TimeUnit.SECONDS)            .writeTimeout(6, TimeUnit.SECONDS)            .readTimeout(6, TimeUnit.SECONDS)            .retryOnConnectionFailure(false)            .build();    public static final MediaType JSON            = MediaType.parse(\"application/json; charset=utf-8\");    @Override    public void onCreate() &#123;        super.onCreate();        mApplication = this;        setLogger();        new Thread(new Runnable() &#123;            @Override            public void run() &#123;                sPhoneContactMap = CommonUtils.getAllContactInfo();                TelephonyManager tMgr = (TelephonyManager) getSystemService(Context.TELEPHONY_SERVICE);                sCurrentPhoneNum = tMgr.getLine1Number();                if (!TextUtils.isEmpty(sCurrentPhoneNum)) &#123;                    sCurrentPhoneNum = sCurrentPhoneNum.replace(\" \", \"\")                            .replace(\"+86\", \"\");                &#125;            &#125;        &#125;).start();        String host = SPStaticUtils.getString(TAG_HOST);        int port = SPStaticUtils.getInt(TAG_PORT);        String url = SPStaticUtils.getString(TAG_URL);        if (TextUtils.isEmpty(url)) &#123;            SPStaticUtils.put(TAG_URL, SERVER_URL);            SPStaticUtils.put(TAG_HOST, SERVER_HOST);            SPStaticUtils.put(TAG_PORT, SERVER_PORT);        &#125; else &#123;            SERVER_HOST = host;            SERVER_PORT = port;            SERVER_URL = url;        &#125;    &#125;    private void setLogger() &#123;        Logger.addLogAdapter(new AndroidLogAdapter());        Logger.addLogAdapter(new AndroidLogAdapter() &#123;            @Override            public boolean isLoggable(int priority, String tag) &#123;                return BuildConfig.DEBUG;            &#125;        &#125;);        FormatStrategy formatStrategy = PrettyFormatStrategy.newBuilder()                .showThreadInfo(true)  // (Optional) Whether to show thread info or not. Default true                .methodCount(2)         // (Optional) How many method line to show. Default 2                .methodOffset(0)        // (Optional) Hides internal method calls up to offset. Default 5                .tag(\"PeoceWang\")   // (Optional) Global tag for every log. Default PRETTY_LOGGER                .build();        Logger.addLogAdapter(new AndroidLogAdapter(formatStrategy));        Logger.addLogAdapter(new DiskLogAdapter());    &#125;&#125;\nEncryptUtils.java (加密方法)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155public class EncryptUtils &#123;    private static String s_AES_KEY = \"0@NSfpy#L9@ec%34654yZ7Jz5mD@xI$B#2r\";    private static String a_AES_IV = \"6aStDl7Yr4364CM3gq\";    private static String OBSCURE_KEY[] = &#123;\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\",            \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"I\", \"J\", \"K\", \"L\", \"M\",            \"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\", \"U\", \"V\", \"W\", \"X\", \"Y\", \"Z\",            \"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\",            \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\",            \"+\", \"=\"    &#125;;    private static String OBSCURE_VALUE1[] = &#123;\"a\", \"Z\", \"=\", \"I\", \"j\", \"w\", \"9\", \"B\", \"v\", \"+\", \"f\", \"g\", \"1\", \"6\", \"y\", \"N\", \"C\", \"4\", \"k\", \"t\", \"O\", \"m\", \"e\",            \"l\",            \"q\", \"3\", \"R\", \"u\", \"8\", \"7\", \"S\", \"2\", \"Q\", \"0\", \"P\", \"c\", \"5\", \"H\", \"r\", \"G\", \"E\", \"b\", \"J\", \"W\", \"o\", \"M\", \"K\",            \"i\",            \"U\", \"x\", \"L\", \"V\", \"z\", \"F\", \"Y\", \"n\", \"X\", \"A\", \"p\", \"T\", \"s\", \"D\", \"d\", \"h\"    &#125;;    private static String OBSCURE_VALUE2[] = &#123;\"i\", \"z\", \"+\", \"1\", \"M\", \"y\", \"t\", \"Z\", \"e\", \"C\", \"3\", \"6\", \"w\", \"D\", \"5\", \"O\", \"o\", \"L\", \"v\", \"u\", \"0\", \"P\", \"j\",            \"Q\",            \"Y\", \"s\", \"U\", \"G\", \"B\", \"A\", \"x\", \"m\", \"h\", \"F\", \"T\", \"q\", \"p\", \"W\", \"8\", \"I\", \"d\", \"n\", \"H\", \"4\", \"f\", \"a\", \"c\",            \"V\",            \"=\", \"E\", \"b\", \"9\", \"S\", \"2\", \"l\", \"r\", \"k\", \"N\", \"K\", \"X\", \"J\", \"7\", \"R\", \"g\"    &#125;;    private static String OBSCURE_VALUE3[] = &#123;\"A\", \"3\", \"F\", \"=\", \"Z\", \"c\", \"T\", \"p\", \"s\", \"L\", \"i\", \"+\", \"5\", \"7\", \"j\", \"R\", \"l\", \"d\", \"q\", \"I\", \"m\", \"D\", \"h\",            \"M\",            \"P\", \"U\", \"x\", \"z\", \"W\", \"8\", \"K\", \"S\", \"E\", \"0\", \"Q\", \"X\", \"r\", \"e\", \"2\", \"k\", \"6\", \"g\", \"1\", \"9\", \"O\", \"J\", \"V\",            \"f\",            \"t\", \"N\", \"Y\", \"o\", \"H\", \"v\", \"w\", \"n\", \"G\", \"4\", \"u\", \"B\", \"C\", \"a\", \"y\", \"b\"    &#125;;    private static ArrayMap OBSCURE_MAP1 = new ArrayMap();    private static ArrayMap OBSCURE_MAP2 = new ArrayMap();    private static ArrayMap OBSCURE_MAP3 = new ArrayMap();    private static final int[] INSERT_POSITION = &#123;0, 5, 7, 9, 22, 30, 31, 35, 39, 42&#125;;    private static final int[] INSERT_MSG_LEN = &#123;7, 12, 10, 6, 9, 6, 10, 8, 9, 4&#125;;    private static ArrayMap&lt;Integer, Integer&gt; POS_LEN_MAP = new ArrayMap();    static &#123;        int len = OBSCURE_KEY.length;        for (int i = 0; i &lt; len; i++) &#123;            OBSCURE_MAP1.put(OBSCURE_KEY[i], OBSCURE_VALUE1[i]);            OBSCURE_MAP2.put(OBSCURE_KEY[i], OBSCURE_VALUE2[i]);            OBSCURE_MAP3.put(OBSCURE_KEY[i], OBSCURE_VALUE3[i]);        &#125;        len = INSERT_POSITION.length;        for (int i = 0; i &lt; len; i++) &#123;            POS_LEN_MAP.put(INSERT_POSITION[i], INSERT_MSG_LEN[i]);        &#125;    &#125;    public static String encrypt(String from, String body) &#123;        ArrayMap&lt;String, String&gt; arrayMap = new ArrayMap(2);        arrayMap.put(\"FROM\", from);        arrayMap.put(\"BODY\", body);        try &#123;            return obscureString(getBase64Encode(map2Json(arrayMap).toString()));        &#125; catch (Exception e) &#123;            e.printStackTrace();        &#125;        return \"ENCRYPT ERROR!!!\";    &#125;    private static String getBase64Encode(String plainStr) &#123;        return Base64.encodeToString(plainStr.getBytes(), Base64.NO_WRAP);    &#125;    private static String replaceChar(String plainString, ArrayMap arrayMap) &#123;        StringBuilder stringBuilder = new StringBuilder();        int stringLen = plainString.length();        for (int i = 0; i &lt; stringLen; i++) &#123;            String c = String.valueOf(plainString.charAt(i));            if (arrayMap.containsKey(c)) &#123;                stringBuilder.append(arrayMap.get(c));            &#125; else &#123;                stringBuilder.append(c);            &#125;        &#125;        return stringBuilder.toString();    &#125;    private static String getRandomString(int len) &#123;        StringBuilder stringBuilder = new StringBuilder(len);        for (int i = 0; i &lt; len; i++) &#123;            stringBuilder.append((char) ('(' + new Random().nextInt(50)));        &#125;        return stringBuilder.toString();    &#125;    private static String addReduceChar(String plainString) &#123;        StringBuilder stringBuilder = new StringBuilder(plainString);        for (int pos : INSERT_POSITION) &#123;            stringBuilder.insert(pos, getRandomString(POS_LEN_MAP.get(pos)));        &#125;        return stringBuilder.toString();    &#125;    public static String removeReduceChar(String plainString) &#123;        StringBuilder stringBuilder = new StringBuilder(plainString);        int len = INSERT_POSITION.length;        for (int i = len - 1; i &gt;= 0; i--) &#123;            String firstStr = stringBuilder.substring(0, INSERT_POSITION[i]);            String secondStr = stringBuilder.substring(INSERT_POSITION[i] + INSERT_MSG_LEN[i], stringBuilder.length());            stringBuilder = new StringBuilder(firstStr + secondStr);        &#125;        return stringBuilder.toString();    &#125;    //   加密过程：    //   原文--&gt; Json -&gt; Base64--&gt; AES(CBC) --&gt; 一轮字符替换 --&gt; 二轮字符替换  --&gt; 指定位置添加冗余信息 --&gt; 三轮字符替换  --&gt; 密文    private static String obscureString(String plainString) throws Exception &#123;        String obsString = aesEncrypt(plainString);        obsString = replaceChar(obsString, OBSCURE_MAP1);        obsString = replaceChar(obsString, OBSCURE_MAP2);        obsString = addReduceChar(obsString);        obsString = replaceChar(obsString, OBSCURE_MAP3);        return obsString;    &#125;    private static String aesEncrypt(String sSrc) throws Exception &#123;        Cipher cipher = Cipher.getInstance(\"AES/CBC/PKCS5Padding\");        byte[] raw = s_AES_KEY.getBytes();        SecretKeySpec skeySpec = new SecretKeySpec(raw, \"AES\");        IvParameterSpec iv = new IvParameterSpec(a_AES_IV.getBytes());//使用CBC模式，需要一个向量iv，可增加加密算法的强度        cipher.init(Cipher.ENCRYPT_MODE, skeySpec, iv);        byte[] encrypted = cipher.doFinal(sSrc.getBytes(\"utf-8\"));//        return new BASE64Encoder().encode(encrypted);//此处使用BASE64做转码。        StringBuilder sb = new StringBuilder();  //此处使用十六进制转码。        for (byte b : encrypted) &#123;            sb.append(String.format(\"%02X\", b));        &#125;        return sb.toString();    &#125;    public static String aesDecrypt(String sSrc) throws Exception &#123;//        try &#123;//            byte[] raw = sKey.getBytes(\"ASCII\");//            SecretKeySpec skeySpec = new SecretKeySpec(raw, \"AES\");//            Cipher cipher = Cipher.getInstance(\"AES/CBC/PKCS5Padding\");//            IvParameterSpec iv = new IvParameterSpec(ivParameter.getBytes());//            cipher.init(Cipher.DECRYPT_MODE, skeySpec, iv);//            byte[] encrypted1 = new BASE64Decoder().decodeBuffer(sSrc);//先用base64解密//            byte[] original = cipher.doFinal(encrypted1);//            String originalString = new String(original, \"utf-8\");//            return originalString;//        &#125; catch (Exception ex) &#123;//            return null;//        &#125;        return null;    &#125;&#125;","dateCreated":"2017-05-23T16:15:00+08:00","dateModified":"2020-11-25T08:18:20+08:00","datePublished":"2017-05-23T16:15:00+08:00","description":"可以转发所接收到短信的Android App","headline":"旧手机短信转发的解决方案（二）Android端","image":["https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/android_logo.png"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/"},"publisher":{"@type":"Organization","name":"AndrewWang","sameAs":["https://github.com/AndrewWang1993","https://stackoverflow.com/users/4209302/andrewwang","mailto:fernando_caudill@outlook.com"],"image":"https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/avatar(7).png","logo":{"@type":"ImageObject","url":"https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/avatar(7).png"}},"url":"https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/","keywords":"开发","thumbnailUrl":"https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/android_logo.png"}</script>
    <meta name="description" content="可以转发所接收到短信的Android App">
<meta name="keywords" content="开发">
<meta property="og:type" content="blog">
<meta property="og:title" content="旧手机短信转发的解决方案（二）Android端">
<meta property="og:url" content="https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/index.html">
<meta property="og:site_name" content="AndrewWang&#39;s Blog">
<meta property="og:description" content="可以转发所接收到短信的Android App">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/sms_android.png">
<meta property="og:updated_time" content="2020-11-25T00:18:20.008Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="旧手机短信转发的解决方案（二）Android端">
<meta name="twitter:description" content="可以转发所接收到短信的Android App">
<meta name="twitter:image" content="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/sms_android.png">
<meta name="twitter:creator" content="@https:&#x2F;&#x2F;twitter.com&#x2F;JamesMcMurr">
    
    
        
    
    
        <meta property="og:image" content="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/avatar(7).png"/>
    
    
        <meta property="og:image" content="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/android_logo.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/android_logo.png" />
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/css/style-c4ozcsklz4kht2pebhp44xorvyverh23toayhn7i6ubrpyedak24hv1v0hyd.min.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">AndrewWang&#39;s Blog</a>
    </div>
    
        
            <a class="header-right-picture " href="#about">
        
        
            <img class="header-picture" src="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/avatar(7).png" alt="Author&#39;s picture">
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/avatar(7).png" alt="Author&#39;s picture">
                </a>
                <h4 class="sidebar-profile-name">AndrewWang</h4>
                
                    <h5 class="sidebar-profile-bio"><p>凡是过去，皆为序章<br>须知参差百态，乃是幸福本源<br>邮箱：<a href="mailto:fernando_caudill@outlook.com" target="_blank">fernando_caudill@outlook.com</a></p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/ " title="Home">
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-categories" title="Categories">
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-tags" title="Tags">
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-archives" title="Archives">
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link open-algolia-search" href="#search" title="Search">
                    
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="#about" title="About">
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/AndrewWang1993" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://stackoverflow.com/users/4209302/andrewwang" target="_blank" rel="noopener" title="Stack Overflow">
                    
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="mailto:fernando_caudill@outlook.com" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/atom.xml" title="RSS">
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            旧手机短信转发的解决方案（二）Android端
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2017-05-23T16:15:00+08:00">
	
		    May 23, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Android/">Android</a>, <a class="category-link" href="/categories/Android/Java/">Java</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>可以转发所接收到短信的Android App<br><a id="more"></a></p>
<center><br><img src="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/sms_android.png"><br>代码结构<br></center>

<h5 id="ShortMessageBean-java-短消息实体类"><a href="#ShortMessageBean-java-短消息实体类" class="headerlink" title="ShortMessageBean.java (短消息实体类)"></a>ShortMessageBean.java (短消息实体类)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShortMessageBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> String obsContent;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> currentCount;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> msgId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShortMessageBean</span><span class="params">(String content, String obsContent, <span class="keyword">int</span> currentCount, <span class="keyword">int</span> msgId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">        <span class="keyword">this</span>.obsContent = obsContent;</span><br><span class="line">        <span class="keyword">this</span>.currentCount = currentCount;</span><br><span class="line">        <span class="keyword">this</span>.msgId = msgId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShortMessageBean</span><span class="params">(String content, String obsContent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">        <span class="keyword">this</span>.obsContent = obsContent;</span><br><span class="line">        <span class="keyword">this</span>.currentCount = SMSAplication.MAX_RETRY_COUNT;</span><br><span class="line">        <span class="keyword">this</span>.msgId = <span class="keyword">new</span> Random().nextInt(Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getObsContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obsContent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setObsContent</span><span class="params">(String obsContent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obsContent = obsContent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCurrentCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> currentCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentCount</span><span class="params">(<span class="keyword">int</span> currentCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.currentCount = currentCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMsgId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msgId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsgId</span><span class="params">(<span class="keyword">int</span> msgId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msgId = msgId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ShortMessageBean&#123;"</span> +</span><br><span class="line">                <span class="string">"content='"</span> + content + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", obsContent='"</span> + obsContent + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", currentCount="</span> + currentCount +</span><br><span class="line">                <span class="string">", msgId="</span> + msgId +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="MainActivity-java（主程序）"><a href="#MainActivity-java（主程序）" class="headerlink" title="MainActivity.java（主程序）"></a>MainActivity.java（主程序）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Button mButtonClear;</span><br><span class="line">    Button mButtonSend;</span><br><span class="line">    TextView mSMSlogTextView;</span><br><span class="line">    EditText mEditText;</span><br><span class="line">    BroadcastReceiver mSMCommingReceiver, mScreenReceiver, mBatteryReceiver;</span><br><span class="line">    IntentFilter mSMSIntentFilter, mScreenIntentFilter, mBatteryFilter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> currentDay = Calendar.getInstance().get(Calendar.DAY_OF_MONTH);</span><br><span class="line">    SimpleDateFormat mSimpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"HH:mm:ss"</span>, Locale.getDefault());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MSG_NET_SEND = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MSG_SMS_SEND = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint</span>(<span class="string">"HandlerLeak"</span>)</span><br><span class="line">    Handler mHandler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> ShortMessageBean shortMessageBean = (ShortMessageBean) msg.obj;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> currentCount = shortMessageBean.getCurrentCount();</span><br><span class="line">            <span class="keyword">final</span> String content = shortMessageBean.getContent();</span><br><span class="line">            <span class="keyword">final</span> String obsContent = shortMessageBean.getObsContent();</span><br><span class="line">            Logger.i(<span class="string">"MESSAGE ID --&gt;"</span> + shortMessageBean.getMsgId());</span><br><span class="line">            <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">                <span class="keyword">case</span> MSG_NET_SEND:</span><br><span class="line">                    ArrayMap&lt;String, String&gt; params = <span class="keyword">new</span> ArrayMap&lt;&gt;();</span><br><span class="line">                    params.put(<span class="string">"msg"</span>, obsContent);</span><br><span class="line"></span><br><span class="line">                    RequestBody body = RequestBody.create(JSON, <span class="keyword">new</span> JSONObject(params).toString());</span><br><span class="line">                    <span class="comment">//避免重试时堆栈中还有此URL请求</span></span><br><span class="line">                    String randomURL = SERVER_URL + <span class="string">"?id="</span> + (<span class="keyword">new</span> Random().nextInt(<span class="number">9999999</span>) + <span class="number">1</span>);</span><br><span class="line">                    Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                            .url(randomURL)</span><br><span class="line">                            .post(body)</span><br><span class="line">                            .build();</span><br><span class="line"></span><br><span class="line">                    client.newCall(request).enqueue(<span class="keyword">new</span> okhttp3.Callback() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                            <span class="keyword">if</span> (response.isSuccessful()) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    JSONObject rspJson = <span class="keyword">new</span> JSONObject(response.body().string());</span><br><span class="line">                                    <span class="keyword">final</span> String divider;</span><br><span class="line">                                    String rspStr = rspJson.optString(<span class="string">"rsp"</span>);</span><br><span class="line">                                    <span class="keyword">if</span> (rspStr.contains(<span class="string">"200"</span>)) &#123;</span><br><span class="line">                                        divider = NORMAL_DIVIDER;</span><br><span class="line">                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        divider = ABNORMAL_DIVIDER;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    Logger.i(<span class="string">"SEND --&gt;"</span> + content);</span><br><span class="line">                                    <span class="comment">//该回调不在主线程</span></span><br><span class="line">                                    MainActivity.<span class="keyword">this</span>.runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                                        <span class="meta">@Override</span></span><br><span class="line">                                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                                            checkClearScreen();</span><br><span class="line">                                            addTextViewMessage(mSMSlogTextView, divider +</span><br><span class="line">                                                    mSimpleDateFormat.format(<span class="keyword">new</span> Date()) + <span class="string">"--&gt;  "</span> + content);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;);</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">                                    Logger.e(<span class="string">"服务器返回Json格式异常"</span>);</span><br><span class="line">                                    e.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                Logger.e(<span class="string">"服务器返回异常"</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">                            Logger.e(<span class="string">"请求失败 "</span> + e.toString());</span><br><span class="line">                            <span class="keyword">if</span> (currentCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="comment">//如果网络已连接但是不通，尝试进行4G/WIFI切换</span></span><br><span class="line">                                <span class="keyword">if</span> ((currentCount == <span class="number">3</span>) &amp;&amp; !ConnectivityUtils.isOnline2()) &#123;</span><br><span class="line">                                    Logger.e(<span class="string">"NO NETWORK--&gt; COUNT "</span> + currentCount);</span><br><span class="line">                                    Logger.e(<span class="string">"NO NETWORK--&gt;  try toggle wifi"</span>);</span><br><span class="line">                                    ConnectivityUtils.toggleWifi();</span><br><span class="line">                                &#125;</span><br><span class="line">                                Logger.e(<span class="string">"ERROR COUNT: "</span> + currentCount);</span><br><span class="line">                                <span class="keyword">int</span> delayTime = (MAX_RETRY_COUNT - currentCount) * RETRY_INTERVAL;</span><br><span class="line">                                shortMessageBean.setCurrentCount(currentCount - <span class="number">1</span>);</span><br><span class="line">                                send(MSG_NET_SEND, delayTime, shortMessageBean);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                send(MSG_SMS_SEND, shortMessageBean);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> MSG_SMS_SEND:</span><br><span class="line">                    sendByPhone(content);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        setAllowNetWorkMainThread();</span><br><span class="line">        Logger.d(<span class="string">"MainActivity CREATE"</span>);</span><br><span class="line"></span><br><span class="line">        mButtonClear = (Button) findViewById(R.id.button_clear);</span><br><span class="line">        mButtonSend = (Button) findViewById(R.id.button_send);</span><br><span class="line">        mSMSlogTextView = (TextView) findViewById(R.id.smsLogTextView);</span><br><span class="line">        mSMSlogTextView.setMovementMethod(<span class="keyword">new</span> ScrollingMovementMethod());</span><br><span class="line">        mEditText = (EditText) findViewById(R.id.edit_text);</span><br><span class="line">        mButtonClear.setOnLongClickListener(<span class="keyword">new</span> View.OnLongClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">boolean</span> isInputBarVisible = mEditText.getVisibility() == View.VISIBLE;</span><br><span class="line">                mEditText.setVisibility(isInputBarVisible ? View.GONE : View.VISIBLE);</span><br><span class="line">                <span class="keyword">if</span> (!isInputBarVisible) &#123;</span><br><span class="line">                    mEditText.setText(SERVER_HOST + <span class="string">":"</span> + SERVER_PORT);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                String url = mEditText.getText().toString().trim();</span><br><span class="line">                <span class="keyword">if</span> (!TextUtils.isEmpty(url)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!url.contains(<span class="string">"http"</span>)) &#123;</span><br><span class="line">                        Toast.makeText(getApplicationContext(), <span class="string">"必须含有http或者https"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    String[] urlSplit = url.split(<span class="string">":"</span>);</span><br><span class="line">                    <span class="keyword">if</span> (urlSplit.length == <span class="number">2</span>) &#123;</span><br><span class="line">                        SERVER_HOST = url;</span><br><span class="line">                        SERVER_PORT = <span class="number">58585</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (urlSplit.length == <span class="number">3</span>) &#123;</span><br><span class="line">                        SERVER_HOST = urlSplit[<span class="number">0</span>] + <span class="string">":"</span> + urlSplit[<span class="number">1</span>];</span><br><span class="line">                        SERVER_PORT = Integer.valueOf(urlSplit[<span class="number">2</span>]);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        Toast.makeText(getApplicationContext(), <span class="string">"URL不合法"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    SERVER_HOST = SERVER_FIX_HOST;</span><br><span class="line">                    SERVER_PORT = <span class="number">58585</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                SERVER_URL = SERVER_HOST + <span class="string">":"</span> + SERVER_PORT + SERVER_PATH;</span><br><span class="line"></span><br><span class="line">                SPStaticUtils.put(TAG_URL, SERVER_URL);</span><br><span class="line">                SPStaticUtils.put(TAG_HOST, SERVER_HOST);</span><br><span class="line">                SPStaticUtils.put(TAG_PORT, SERVER_PORT);</span><br><span class="line">                <span class="keyword">if</span> (mEditText.getVisibility() == View.GONE) &#123;</span><br><span class="line">                    Toast.makeText(mApplication, SERVER_URL + <span class="string">" 已生效"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        mButtonSend.setOnLongClickListener(<span class="keyword">new</span> View.OnLongClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line"><span class="comment">//                SERVER_HOST = SERVER_FIX_HOST;</span></span><br><span class="line"><span class="comment">//                SERVER_PORT = 58585;</span></span><br><span class="line"><span class="comment">//                SERVER_URL = SERVER_HOST + ":" + SERVER_PORT + SERVER_PATH;</span></span><br><span class="line"><span class="comment">//                Toast.makeText(mApplication, SERVER_URL + "已重置服务器地址", Toast.LENGTH_SHORT).show();</span></span><br><span class="line"></span><br><span class="line">                toggleServer(<span class="keyword">false</span>);</span><br><span class="line">                finish();</span><br><span class="line">                android.os.Process.killProcess(android.os.Process.myPid());</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        setBrocastReceiver();</span><br><span class="line"></span><br><span class="line">        setIntentFilter();</span><br><span class="line"></span><br><span class="line">        toggleServer(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart();</span><br><span class="line">        PhoneCallReceiver.setOnRingListener(<span class="keyword">new</span> PhoneCallReceiver.OnRingListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onIncomingCallReceived</span><span class="params">(Context ctx, String number, Date start)</span> </span>&#123;</span><br><span class="line">                sendIncomingRingMsg(number.replace(<span class="string">"+"</span>, <span class="string">""</span>).replace(<span class="string">"-"</span>, <span class="string">""</span>).replace(<span class="string">" "</span>, <span class="string">""</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        Logger.i(<span class="string">"MainActivity RESUME"</span>);</span><br><span class="line">        registerReceiver(mSMCommingReceiver, mSMSIntentFilter);</span><br><span class="line">        registerReceiver(mScreenReceiver, mScreenIntentFilter);</span><br><span class="line">        registerReceiver(mBatteryReceiver, mBatteryFilter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        Logger.i(<span class="string">"MainActivity DESTORY"</span>);</span><br><span class="line">        unregisterReceiver(mSMCommingReceiver);</span><br><span class="line">        unregisterReceiver(mScreenReceiver);</span><br><span class="line">        unregisterReceiver(mBatteryReceiver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setBrocastReceiver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mSMCommingReceiver = <span class="keyword">new</span> BroadcastReceiver() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">                String msg_from = <span class="string">""</span>;</span><br><span class="line">                StringBuilder msgBodyStringBuilder = <span class="keyword">new</span> StringBuilder(<span class="number">200</span>);</span><br><span class="line">                Bundle bundle = intent.getExtras();</span><br><span class="line">                SmsMessage[] msgs;</span><br><span class="line">                <span class="keyword">if</span> (bundle != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Object[] pdus = (Object[]) bundle.get(<span class="string">"pdus"</span>);</span><br><span class="line">                        <span class="keyword">assert</span> pdus != <span class="keyword">null</span>;</span><br><span class="line">                        msgs = <span class="keyword">new</span> SmsMessage[pdus.length];</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; msgs.length; i++) &#123;</span><br><span class="line">                            msgs[i] = SmsMessage.createFromPdu((<span class="keyword">byte</span>[]) pdus[i]);</span><br><span class="line">                            msg_from = msgs[i].getOriginatingAddress();</span><br><span class="line">                            msgBodyStringBuilder.append(msgs[i].getMessageBody());</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        String name = SMSAplication.sPhoneContactMap</span><br><span class="line">                                .get(msg_from.replace(<span class="string">"+"</span>, <span class="string">""</span>).replace(<span class="string">"-"</span>, <span class="string">""</span>).replace(<span class="string">" "</span>, <span class="string">""</span>));</span><br><span class="line">                        <span class="keyword">if</span> (!TextUtils.isEmpty(name)) &#123;</span><br><span class="line">                            msgBodyStringBuilder.insert(<span class="number">0</span>, name + <span class="string">"-&gt; "</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        String content = msg_from + <span class="string">"\n"</span> + msgBodyStringBuilder.toString();</span><br><span class="line">                        <span class="comment">//回应飞信消息</span></span><br><span class="line">                        <span class="keyword">if</span> (content.contains(<span class="string">"%YG8Cf^17R*GqzVfxXHP2e"</span>) &amp;&amp; content.contains(<span class="string">"查询手机状态信息"</span>)) &#123;</span><br><span class="line">                            sendStatusMsg();</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (content.contains(<span class="string">"s*Yfb3SdXy9ruUBK8R!gZX"</span>) &amp;&amp; content.contains(<span class="string">"设置网络"</span>)) &#123;</span><br><span class="line">                            setNetMsg(content);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        send(MSG_NET_SEND,</span><br><span class="line">                                <span class="keyword">new</span> ShortMessageBean(content, EncryptUtils.encrypt(msg_from, msgBodyStringBuilder.toString())));</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        Logger.e(e.getMessage());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        mScreenReceiver = <span class="keyword">new</span> BroadcastReceiver() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">                Logger.i(intent.getAction());</span><br><span class="line">                <span class="keyword">if</span> (intent.getAction().equals(Intent.ACTION_SCREEN_OFF)) &#123;</span><br><span class="line">                    Intent starKeepActivityIntent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, KeepLiveActivity.class);</span><br><span class="line">                    startActivity(starKeepActivityIntent);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        mBatteryReceiver = <span class="keyword">new</span> BroadcastReceiver() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent batteryIntent)</span> </span>&#123;</span><br><span class="line">                Logger.i(batteryIntent.getAction());</span><br><span class="line">                <span class="keyword">if</span> (batteryIntent.getAction().equals(Intent.ACTION_BATTERY_LOW)) &#123;</span><br><span class="line">                    sendStatusMsg();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setNetMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        String msg_from = <span class="string">"66666666"</span>;</span><br><span class="line">        String msgBodyString = <span class="string">"设置网络 "</span>;</span><br><span class="line">        <span class="keyword">if</span> (msg.contains(<span class="string">"4G"</span>)) &#123;</span><br><span class="line">            msgBodyString += <span class="string">"4G"</span>;</span><br><span class="line">            ConnectivityUtils.setWifi(<span class="keyword">false</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (msg.contains(<span class="string">"WIFI"</span>)) &#123;</span><br><span class="line">            msgBodyString += <span class="string">"WIFI"</span>;</span><br><span class="line">            ConnectivityUtils.setWifi(<span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            msgBodyString += <span class="string">"NONE"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String content = msg_from + <span class="string">"\n"</span> + msgBodyString;</span><br><span class="line">        Logger.i(content);</span><br><span class="line">        send(MSG_NET_SEND,</span><br><span class="line">                <span class="keyword">new</span> ShortMessageBean(content, EncryptUtils.encrypt(msg_from, msgBodyString)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendStatusMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String msg_from = <span class="string">"88888888"</span>;</span><br><span class="line">        String msgBodyString = <span class="string">"当前电量 "</span> + CommonUtils.getBatteryLevel() + <span class="string">" %"</span>;</span><br><span class="line">        msgBodyString += <span class="string">"\n网络信息 "</span> + ConnectivityUtils.getConnectedInfo(SMSAplication.mApplication);</span><br><span class="line">        msgBodyString += <span class="string">"\n连通信息 "</span> + ConnectivityUtils.isOnline2();</span><br><span class="line">        String content = msg_from + <span class="string">"\n"</span> + msgBodyString;</span><br><span class="line">        Logger.i(content);</span><br><span class="line">        send(MSG_NET_SEND,</span><br><span class="line">                <span class="keyword">new</span> ShortMessageBean(content, EncryptUtils.encrypt(msg_from, msgBodyString)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendIncomingRingMsg</span><span class="params">(String number)</span> </span>&#123;</span><br><span class="line">        String msg_from = number;</span><br><span class="line">        String msgBodyString = <span class="string">"【来电提醒】 "</span> + number;</span><br><span class="line"></span><br><span class="line">        String name = SMSAplication.sPhoneContactMap.get(number);</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(name)) &#123;</span><br><span class="line">            msgBodyString = <span class="string">"【来电提醒】-&gt;"</span> + name;</span><br><span class="line">        &#125;</span><br><span class="line">        String content = msg_from + <span class="string">"\n"</span> + msgBodyString;</span><br><span class="line">        Logger.i(content);</span><br><span class="line">        send(MSG_NET_SEND,</span><br><span class="line">                <span class="keyword">new</span> ShortMessageBean(content, EncryptUtils.encrypt(msg_from, msgBodyString)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setIntentFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mSMSIntentFilter = <span class="keyword">new</span> IntentFilter(<span class="string">"android.provider.Telephony.SMS_RECEIVED"</span>);</span><br><span class="line">        mSMSIntentFilter.setPriority(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        mScreenIntentFilter = <span class="keyword">new</span> IntentFilter(Intent.ACTION_SCREEN_OFF);</span><br><span class="line">        mScreenIntentFilter.setPriority(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        mBatteryFilter = <span class="keyword">new</span> IntentFilter(Intent.ACTION_BATTERY_LOW);</span><br><span class="line">        mBatteryFilter.setPriority(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">toggleServer</span><span class="params">(<span class="keyword">boolean</span> start)</span> </span>&#123;</span><br><span class="line">        Intent serverIntent = <span class="keyword">new</span> Intent(getApplicationContext(), KeepLiveServer.class);</span><br><span class="line">        serverIntent.putExtra(<span class="string">"status"</span>, start ? <span class="string">"start"</span> : <span class="string">"stop"</span>);</span><br><span class="line">        startService(serverIntent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(<span class="keyword">int</span> what, ShortMessageBean shortMessageBean)</span> </span>&#123;</span><br><span class="line">        Message message = mHandler.obtainMessage(what);</span><br><span class="line">        message.obj = shortMessageBean;</span><br><span class="line">        message.sendToTarget();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(<span class="keyword">int</span> what, <span class="keyword">int</span> delay, ShortMessageBean shortMessageBean)</span> </span>&#123;</span><br><span class="line">        Message message = <span class="keyword">new</span> Message();</span><br><span class="line">        message.what = what;</span><br><span class="line">        message.obj = shortMessageBean;</span><br><span class="line">        mHandler.sendMessageDelayed(message, delay);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 由本机发送</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content sms content</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendByPhone</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> nowDay = Calendar.getInstance().get(Calendar.DAY_OF_MONTH);</span><br><span class="line">        <span class="keyword">if</span> (nowDay != SMSAplication.sCurrentDay) &#123;</span><br><span class="line">            SMSAplication.sSMSByPhoneTodayCount = <span class="number">0</span>;</span><br><span class="line">            SMSAplication.sCurrentDay = nowDay;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果使用短信，每天发送超过10条</span></span><br><span class="line">        <span class="keyword">if</span> (SMSAplication.sSMSByPhoneTodayCount &gt; SMSAplication.MAX_SMS_BY_PHONE_COUNT) &#123;</span><br><span class="line">            addTextViewMessage(mSMSlogTextView, ABNORMAL_DIVIDER +</span><br><span class="line">                    mSimpleDateFormat.format(<span class="keyword">new</span> Date()) + <span class="string">"--&gt;  "</span> + <span class="string">"使用短信发送超过每日限制 !!!!!!\n"</span></span><br><span class="line">                    + content);</span><br><span class="line">            Logger.e(<span class="string">"使用短信发送超过每日限制 : "</span> + content);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果是验证码短信则本机发送</span></span><br><span class="line">        <span class="keyword">if</span> ((content.contains(<span class="string">"动态"</span>) || content.contains(<span class="string">"验证"</span>)) &amp;&amp; (!content.contains(<span class="string">"Test__"</span>))) &#123;</span><br><span class="line">            <span class="keyword">if</span> (TextUtils.isEmpty(SMSAplication.sCurrentPhoneNum)) &#123;</span><br><span class="line">                CommonUtils.sendLongSMS(SMSAplication.S_PHONE_NUMBER_POOLS[<span class="number">0</span>], content);</span><br><span class="line">                addTextViewMessage(mSMSlogTextView, ABNORMAL_DIVIDER +</span><br><span class="line">                        mSimpleDateFormat.format(<span class="keyword">new</span> Date()) + <span class="string">"--&gt;  "</span> + <span class="string">"验证码使用短信发送 !!!!!!\n"</span></span><br><span class="line">                        + content);</span><br><span class="line">                Logger.e(<span class="string">"验证码使用短信发送: "</span> + content);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (String num : SMSAplication.S_PHONE_NUMBER_POOLS) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!SMSAplication.sCurrentPhoneNum.contains(num)) &#123;</span><br><span class="line">                        CommonUtils.sendLongSMS(num, content);</span><br><span class="line">                        addTextViewMessage(mSMSlogTextView, ABNORMAL_DIVIDER +</span><br><span class="line">                                mSimpleDateFormat.format(<span class="keyword">new</span> Date()) + <span class="string">"--&gt;  "</span> + <span class="string">"验证码使用短信发送 !!!!!!\n"</span></span><br><span class="line">                                + content);</span><br><span class="line">                        Logger.e(<span class="string">"验证码使用短信发送: "</span> + content);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            SMSAplication.sSMSByPhoneTodayCount++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            addTextViewMessage(mSMSlogTextView, ABNORMAL_DIVIDER +</span><br><span class="line">                    mSimpleDateFormat.format(<span class="keyword">new</span> Date()) + <span class="string">"--&gt;  "</span> + <span class="string">"非验证码不使用短信发送 !!!!!!\n"</span></span><br><span class="line">                    + content);</span><br><span class="line">            Logger.e(<span class="string">"非验证码不使用短信发送 : "</span> + content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        mSMSlogTextView.setText(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkClearScreen</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> nowDay = Calendar.getInstance().get(Calendar.DAY_OF_MONTH);</span><br><span class="line">        <span class="keyword">if</span> (nowDay != currentDay) &#123;</span><br><span class="line">            mSMSlogTextView.setText(<span class="string">""</span>);</span><br><span class="line">            currentDay = nowDay;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stimulateSend</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        String msg_from = TEST_SMS_FROM[<span class="keyword">new</span> Random().nextInt(TEST_SMS_FROM.length)];</span><br><span class="line">        String msgBodyString = TEST_SMS_BODY[<span class="keyword">new</span> Random().nextInt(TEST_SMS_BODY.length)];</span><br><span class="line">        String content = msg_from + <span class="string">"\n"</span> + msgBodyString;</span><br><span class="line">        ShortMessageBean shortMessageBean = <span class="keyword">new</span> ShortMessageBean(content, EncryptUtils.encrypt(msg_from, msgBodyString));</span><br><span class="line">        send(MSG_NET_SEND, shortMessageBean);</span><br><span class="line">        Toast.makeText(mApplication, <span class="string">"模拟接收到短信"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addTextViewMessage</span><span class="params">(TextView mTextView, String msg)</span> </span>&#123;</span><br><span class="line">        mTextView.append(msg);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> scrollAmount =</span><br><span class="line">                mTextView.getLayout().getLineTop(mTextView.getLineCount()) - mTextView.getHeight();</span><br><span class="line">        <span class="keyword">if</span> (scrollAmount &gt; <span class="number">0</span>)</span><br><span class="line">            mTextView.scrollTo(<span class="number">0</span>, scrollAmount);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            mTextView.scrollTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="SMSAplication-java"><a href="#SMSAplication-java" class="headerlink" title="SMSAplication.java"></a>SMSAplication.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SMSAplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Application mApplication;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SERVER_FIX_HOST = <span class="string">"https://m.xiaoo.ml"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String SERVER_HOST = SERVER_FIX_HOST;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> SERVER_PORT = <span class="number">58585</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String SERVER_PATH = <span class="string">"/Cbu8x23asdfwfsae9fJGZ/api/push_sms"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String SERVER_URL = SERVER_HOST + <span class="string">":"</span> + SERVER_PORT + SERVER_PATH;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String TAG_HOST = <span class="string">"TAG_HOST"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String TAG_PORT = <span class="string">"TAG_PORT"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String TAG_URL = <span class="string">"TAG_URL"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;String, String&gt; sPhoneContactMap;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String sCurrentPhoneNum;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String[] S_PHONE_NUMBER_POOLS = &#123;<span class="string">"13000000000"</span>, <span class="string">"13000000001"</span>&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_SMS_BY_PHONE_COUNT = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> sSMSByPhoneTodayCount = <span class="number">0</span>; <span class="comment">// 没网状态每天最多发送10条验证码短信</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> sCurrentDay = Calendar.getInstance().get(Calendar.DAY_OF_MONTH);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_RETRY_COUNT = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RETRY_INTERVAL = <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NORMAL_DIVIDER = <span class="string">"\n----------------------------------\n"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ABNORMAL_DIVIDER = <span class="string">"\n************************************\n"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TEST_SMS_FROM[] = &#123;</span><br><span class="line">            <span class="string">"10086"</span>, <span class="string">"10690691036509"</span>, <span class="string">"10584156"</span>,</span><br><span class="line">            <span class="string">"10086"</span>, <span class="string">"10690691036509"</span>, <span class="string">"10584156"</span>&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TEST_SMS_BODY[] = &#123;</span><br><span class="line">            <span class="string">"Test__尊敬的客户：您当前账户余额19.57元，下一个月结日为2017年07月01日。如需充值可点击 http://fj.10086.cn/cz 。【中国移动】"</span>,</span><br><span class="line">            <span class="string">"Test__【百度】588662 (动态验证码),请在30分钟内填写"</span>,</span><br><span class="line">            <span class="string">"Test__【新浪网】感谢您选择新浪云。接下来的日子，我们将全力协助您，并与您携手一起用技术和创意改变世界！，退订回T"</span>,</span><br><span class="line">            <span class="string">"Test__【美团网】506820（换绑手机验证码）。工作人员不会向您索要，请勿向任何人泄露。"</span>,</span><br><span class="line">            <span class="string">"Test__【每日优鲜】&lt;满59减30&gt;红包送你！超级会员周，会员专享商品最高直降30元，还不快抢→ http://t.cn/Ra10SNB 退订TD"</span>,</span><br><span class="line">            <span class="string">"Test__每周五上午10点，持浦发银行卡在食行生鲜APP平台充值并在线支付，即可享受满100元返50元优惠"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">            .connectTimeout(<span class="number">6</span>, TimeUnit.SECONDS)</span><br><span class="line">            .writeTimeout(<span class="number">6</span>, TimeUnit.SECONDS)</span><br><span class="line">            .readTimeout(<span class="number">6</span>, TimeUnit.SECONDS)</span><br><span class="line">            .retryOnConnectionFailure(<span class="keyword">false</span>)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> MediaType JSON</span><br><span class="line">            = MediaType.parse(<span class="string">"application/json; charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        mApplication = <span class="keyword">this</span>;</span><br><span class="line">        setLogger();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                sPhoneContactMap = CommonUtils.getAllContactInfo();</span><br><span class="line">                TelephonyManager tMgr = (TelephonyManager) getSystemService(Context.TELEPHONY_SERVICE);</span><br><span class="line">                sCurrentPhoneNum = tMgr.getLine1Number();</span><br><span class="line">                <span class="keyword">if</span> (!TextUtils.isEmpty(sCurrentPhoneNum)) &#123;</span><br><span class="line">                    sCurrentPhoneNum = sCurrentPhoneNum.replace(<span class="string">" "</span>, <span class="string">""</span>)</span><br><span class="line">                            .replace(<span class="string">"+86"</span>, <span class="string">""</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        String host = SPStaticUtils.getString(TAG_HOST);</span><br><span class="line">        <span class="keyword">int</span> port = SPStaticUtils.getInt(TAG_PORT);</span><br><span class="line">        String url = SPStaticUtils.getString(TAG_URL);</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(url)) &#123;</span><br><span class="line">            SPStaticUtils.put(TAG_URL, SERVER_URL);</span><br><span class="line">            SPStaticUtils.put(TAG_HOST, SERVER_HOST);</span><br><span class="line">            SPStaticUtils.put(TAG_PORT, SERVER_PORT);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            SERVER_HOST = host;</span><br><span class="line">            SERVER_PORT = port;</span><br><span class="line">            SERVER_URL = url;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setLogger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Logger.addLogAdapter(<span class="keyword">new</span> AndroidLogAdapter());</span><br><span class="line">        Logger.addLogAdapter(<span class="keyword">new</span> AndroidLogAdapter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLoggable</span><span class="params">(<span class="keyword">int</span> priority, String tag)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> BuildConfig.DEBUG;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        FormatStrategy formatStrategy = PrettyFormatStrategy.newBuilder()</span><br><span class="line">                .showThreadInfo(<span class="keyword">true</span>)  <span class="comment">// (Optional) Whether to show thread info or not. Default true</span></span><br><span class="line">                .methodCount(<span class="number">2</span>)         <span class="comment">// (Optional) How many method line to show. Default 2</span></span><br><span class="line">                .methodOffset(<span class="number">0</span>)        <span class="comment">// (Optional) Hides internal method calls up to offset. Default 5</span></span><br><span class="line">                .tag(<span class="string">"PeoceWang"</span>)   <span class="comment">// (Optional) Global tag for every log. Default PRETTY_LOGGER</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        Logger.addLogAdapter(<span class="keyword">new</span> AndroidLogAdapter(formatStrategy));</span><br><span class="line">        Logger.addLogAdapter(<span class="keyword">new</span> DiskLogAdapter());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="EncryptUtils-java-加密方法"><a href="#EncryptUtils-java-加密方法" class="headerlink" title="EncryptUtils.java (加密方法)"></a>EncryptUtils.java (加密方法)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncryptUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String s_AES_KEY = <span class="string">"0@NSfpy#L9@ec%34654yZ7Jz5mD@xI$B#2r"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String a_AES_IV = <span class="string">"6aStDl7Yr4364CM3gq"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String OBSCURE_KEY[] = &#123;<span class="string">"0"</span>, <span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>, <span class="string">"6"</span>, <span class="string">"7"</span>, <span class="string">"8"</span>, <span class="string">"9"</span>,</span><br><span class="line">            <span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>, <span class="string">"E"</span>, <span class="string">"F"</span>, <span class="string">"G"</span>, <span class="string">"H"</span>, <span class="string">"I"</span>, <span class="string">"J"</span>, <span class="string">"K"</span>, <span class="string">"L"</span>, <span class="string">"M"</span>,</span><br><span class="line">            <span class="string">"N"</span>, <span class="string">"O"</span>, <span class="string">"P"</span>, <span class="string">"Q"</span>, <span class="string">"R"</span>, <span class="string">"S"</span>, <span class="string">"T"</span>, <span class="string">"U"</span>, <span class="string">"V"</span>, <span class="string">"W"</span>, <span class="string">"X"</span>, <span class="string">"Y"</span>, <span class="string">"Z"</span>,</span><br><span class="line">            <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>, <span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>, <span class="string">"j"</span>, <span class="string">"k"</span>, <span class="string">"l"</span>, <span class="string">"m"</span>,</span><br><span class="line">            <span class="string">"n"</span>, <span class="string">"o"</span>, <span class="string">"p"</span>, <span class="string">"q"</span>, <span class="string">"r"</span>, <span class="string">"s"</span>, <span class="string">"t"</span>, <span class="string">"u"</span>, <span class="string">"v"</span>, <span class="string">"w"</span>, <span class="string">"x"</span>, <span class="string">"y"</span>, <span class="string">"z"</span>,</span><br><span class="line">            <span class="string">"+"</span>, <span class="string">"="</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String OBSCURE_VALUE1[] = &#123;<span class="string">"a"</span>, <span class="string">"Z"</span>, <span class="string">"="</span>, <span class="string">"I"</span>, <span class="string">"j"</span>, <span class="string">"w"</span>, <span class="string">"9"</span>, <span class="string">"B"</span>, <span class="string">"v"</span>, <span class="string">"+"</span>, <span class="string">"f"</span>, <span class="string">"g"</span>, <span class="string">"1"</span>, <span class="string">"6"</span>, <span class="string">"y"</span>, <span class="string">"N"</span>, <span class="string">"C"</span>, <span class="string">"4"</span>, <span class="string">"k"</span>, <span class="string">"t"</span>, <span class="string">"O"</span>, <span class="string">"m"</span>, <span class="string">"e"</span>,</span><br><span class="line">            <span class="string">"l"</span>,</span><br><span class="line">            <span class="string">"q"</span>, <span class="string">"3"</span>, <span class="string">"R"</span>, <span class="string">"u"</span>, <span class="string">"8"</span>, <span class="string">"7"</span>, <span class="string">"S"</span>, <span class="string">"2"</span>, <span class="string">"Q"</span>, <span class="string">"0"</span>, <span class="string">"P"</span>, <span class="string">"c"</span>, <span class="string">"5"</span>, <span class="string">"H"</span>, <span class="string">"r"</span>, <span class="string">"G"</span>, <span class="string">"E"</span>, <span class="string">"b"</span>, <span class="string">"J"</span>, <span class="string">"W"</span>, <span class="string">"o"</span>, <span class="string">"M"</span>, <span class="string">"K"</span>,</span><br><span class="line">            <span class="string">"i"</span>,</span><br><span class="line">            <span class="string">"U"</span>, <span class="string">"x"</span>, <span class="string">"L"</span>, <span class="string">"V"</span>, <span class="string">"z"</span>, <span class="string">"F"</span>, <span class="string">"Y"</span>, <span class="string">"n"</span>, <span class="string">"X"</span>, <span class="string">"A"</span>, <span class="string">"p"</span>, <span class="string">"T"</span>, <span class="string">"s"</span>, <span class="string">"D"</span>, <span class="string">"d"</span>, <span class="string">"h"</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String OBSCURE_VALUE2[] = &#123;<span class="string">"i"</span>, <span class="string">"z"</span>, <span class="string">"+"</span>, <span class="string">"1"</span>, <span class="string">"M"</span>, <span class="string">"y"</span>, <span class="string">"t"</span>, <span class="string">"Z"</span>, <span class="string">"e"</span>, <span class="string">"C"</span>, <span class="string">"3"</span>, <span class="string">"6"</span>, <span class="string">"w"</span>, <span class="string">"D"</span>, <span class="string">"5"</span>, <span class="string">"O"</span>, <span class="string">"o"</span>, <span class="string">"L"</span>, <span class="string">"v"</span>, <span class="string">"u"</span>, <span class="string">"0"</span>, <span class="string">"P"</span>, <span class="string">"j"</span>,</span><br><span class="line">            <span class="string">"Q"</span>,</span><br><span class="line">            <span class="string">"Y"</span>, <span class="string">"s"</span>, <span class="string">"U"</span>, <span class="string">"G"</span>, <span class="string">"B"</span>, <span class="string">"A"</span>, <span class="string">"x"</span>, <span class="string">"m"</span>, <span class="string">"h"</span>, <span class="string">"F"</span>, <span class="string">"T"</span>, <span class="string">"q"</span>, <span class="string">"p"</span>, <span class="string">"W"</span>, <span class="string">"8"</span>, <span class="string">"I"</span>, <span class="string">"d"</span>, <span class="string">"n"</span>, <span class="string">"H"</span>, <span class="string">"4"</span>, <span class="string">"f"</span>, <span class="string">"a"</span>, <span class="string">"c"</span>,</span><br><span class="line">            <span class="string">"V"</span>,</span><br><span class="line">            <span class="string">"="</span>, <span class="string">"E"</span>, <span class="string">"b"</span>, <span class="string">"9"</span>, <span class="string">"S"</span>, <span class="string">"2"</span>, <span class="string">"l"</span>, <span class="string">"r"</span>, <span class="string">"k"</span>, <span class="string">"N"</span>, <span class="string">"K"</span>, <span class="string">"X"</span>, <span class="string">"J"</span>, <span class="string">"7"</span>, <span class="string">"R"</span>, <span class="string">"g"</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String OBSCURE_VALUE3[] = &#123;<span class="string">"A"</span>, <span class="string">"3"</span>, <span class="string">"F"</span>, <span class="string">"="</span>, <span class="string">"Z"</span>, <span class="string">"c"</span>, <span class="string">"T"</span>, <span class="string">"p"</span>, <span class="string">"s"</span>, <span class="string">"L"</span>, <span class="string">"i"</span>, <span class="string">"+"</span>, <span class="string">"5"</span>, <span class="string">"7"</span>, <span class="string">"j"</span>, <span class="string">"R"</span>, <span class="string">"l"</span>, <span class="string">"d"</span>, <span class="string">"q"</span>, <span class="string">"I"</span>, <span class="string">"m"</span>, <span class="string">"D"</span>, <span class="string">"h"</span>,</span><br><span class="line">            <span class="string">"M"</span>,</span><br><span class="line">            <span class="string">"P"</span>, <span class="string">"U"</span>, <span class="string">"x"</span>, <span class="string">"z"</span>, <span class="string">"W"</span>, <span class="string">"8"</span>, <span class="string">"K"</span>, <span class="string">"S"</span>, <span class="string">"E"</span>, <span class="string">"0"</span>, <span class="string">"Q"</span>, <span class="string">"X"</span>, <span class="string">"r"</span>, <span class="string">"e"</span>, <span class="string">"2"</span>, <span class="string">"k"</span>, <span class="string">"6"</span>, <span class="string">"g"</span>, <span class="string">"1"</span>, <span class="string">"9"</span>, <span class="string">"O"</span>, <span class="string">"J"</span>, <span class="string">"V"</span>,</span><br><span class="line">            <span class="string">"f"</span>,</span><br><span class="line">            <span class="string">"t"</span>, <span class="string">"N"</span>, <span class="string">"Y"</span>, <span class="string">"o"</span>, <span class="string">"H"</span>, <span class="string">"v"</span>, <span class="string">"w"</span>, <span class="string">"n"</span>, <span class="string">"G"</span>, <span class="string">"4"</span>, <span class="string">"u"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"a"</span>, <span class="string">"y"</span>, <span class="string">"b"</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ArrayMap OBSCURE_MAP1 = <span class="keyword">new</span> ArrayMap();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ArrayMap OBSCURE_MAP2 = <span class="keyword">new</span> ArrayMap();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ArrayMap OBSCURE_MAP3 = <span class="keyword">new</span> ArrayMap();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span>[] INSERT_POSITION = &#123;<span class="number">0</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">22</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">35</span>, <span class="number">39</span>, <span class="number">42</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span>[] INSERT_MSG_LEN = &#123;<span class="number">7</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ArrayMap&lt;Integer, Integer&gt; POS_LEN_MAP = <span class="keyword">new</span> ArrayMap();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> len = OBSCURE_KEY.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            OBSCURE_MAP1.put(OBSCURE_KEY[i], OBSCURE_VALUE1[i]);</span><br><span class="line">            OBSCURE_MAP2.put(OBSCURE_KEY[i], OBSCURE_VALUE2[i]);</span><br><span class="line">            OBSCURE_MAP3.put(OBSCURE_KEY[i], OBSCURE_VALUE3[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        len = INSERT_POSITION.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            POS_LEN_MAP.put(INSERT_POSITION[i], INSERT_MSG_LEN[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(String from, String body)</span> </span>&#123;</span><br><span class="line">        ArrayMap&lt;String, String&gt; arrayMap = <span class="keyword">new</span> ArrayMap(<span class="number">2</span>);</span><br><span class="line">        arrayMap.put(<span class="string">"FROM"</span>, from);</span><br><span class="line">        arrayMap.put(<span class="string">"BODY"</span>, body);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> obscureString(getBase64Encode(map2Json(arrayMap).toString()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ENCRYPT ERROR!!!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getBase64Encode</span><span class="params">(String plainStr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Base64.encodeToString(plainStr.getBytes(), Base64.NO_WRAP);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">replaceChar</span><span class="params">(String plainString, ArrayMap arrayMap)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">int</span> stringLen = plainString.length();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stringLen; i++) &#123;</span><br><span class="line">            String c = String.valueOf(plainString.charAt(i));</span><br><span class="line">            <span class="keyword">if</span> (arrayMap.containsKey(c)) &#123;</span><br><span class="line">                stringBuilder.append(arrayMap.get(c));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                stringBuilder.append(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getRandomString</span><span class="params">(<span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder(len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            stringBuilder.append((<span class="keyword">char</span>) (<span class="string">'('</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">50</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">addReduceChar</span><span class="params">(String plainString)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder(plainString);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> pos : INSERT_POSITION) &#123;</span><br><span class="line">            stringBuilder.insert(pos, getRandomString(POS_LEN_MAP.get(pos)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">removeReduceChar</span><span class="params">(String plainString)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder(plainString);</span><br><span class="line">        <span class="keyword">int</span> len = INSERT_POSITION.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            String firstStr = stringBuilder.substring(<span class="number">0</span>, INSERT_POSITION[i]);</span><br><span class="line">            String secondStr = stringBuilder.substring(INSERT_POSITION[i] + INSERT_MSG_LEN[i], stringBuilder.length());</span><br><span class="line">            stringBuilder = <span class="keyword">new</span> StringBuilder(firstStr + secondStr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//   加密过程：</span></span><br><span class="line">    <span class="comment">//   原文--&gt; Json -&gt; Base64--&gt; AES(CBC) --&gt; 一轮字符替换 --&gt; 二轮字符替换  --&gt; 指定位置添加冗余信息 --&gt; 三轮字符替换  --&gt; 密文</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">obscureString</span><span class="params">(String plainString)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String obsString = aesEncrypt(plainString);</span><br><span class="line">        obsString = replaceChar(obsString, OBSCURE_MAP1);</span><br><span class="line">        obsString = replaceChar(obsString, OBSCURE_MAP2);</span><br><span class="line">        obsString = addReduceChar(obsString);</span><br><span class="line">        obsString = replaceChar(obsString, OBSCURE_MAP3);</span><br><span class="line">        <span class="keyword">return</span> obsString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">aesEncrypt</span><span class="params">(String sSrc)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">"AES/CBC/PKCS5Padding"</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] raw = s_AES_KEY.getBytes();</span><br><span class="line">        SecretKeySpec skeySpec = <span class="keyword">new</span> SecretKeySpec(raw, <span class="string">"AES"</span>);</span><br><span class="line">        IvParameterSpec iv = <span class="keyword">new</span> IvParameterSpec(a_AES_IV.getBytes());<span class="comment">//使用CBC模式，需要一个向量iv，可增加加密算法的强度</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, skeySpec, iv);</span><br><span class="line">        <span class="keyword">byte</span>[] encrypted = cipher.doFinal(sSrc.getBytes(<span class="string">"utf-8"</span>));</span><br><span class="line"><span class="comment">//        return new BASE64Encoder().encode(encrypted);//此处使用BASE64做转码。</span></span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();  <span class="comment">//此处使用十六进制转码。</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> b : encrypted) &#123;</span><br><span class="line">            sb.append(String.format(<span class="string">"%02X"</span>, b));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">aesDecrypt</span><span class="params">(String sSrc)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//        try &#123;</span></span><br><span class="line"><span class="comment">//            byte[] raw = sKey.getBytes("ASCII");</span></span><br><span class="line"><span class="comment">//            SecretKeySpec skeySpec = new SecretKeySpec(raw, "AES");</span></span><br><span class="line"><span class="comment">//            Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");</span></span><br><span class="line"><span class="comment">//            IvParameterSpec iv = new IvParameterSpec(ivParameter.getBytes());</span></span><br><span class="line"><span class="comment">//            cipher.init(Cipher.DECRYPT_MODE, skeySpec, iv);</span></span><br><span class="line"><span class="comment">//            byte[] encrypted1 = new BASE64Decoder().decodeBuffer(sSrc);//先用base64解密</span></span><br><span class="line"><span class="comment">//            byte[] original = cipher.doFinal(encrypted1);</span></span><br><span class="line"><span class="comment">//            String originalString = new String(original, "utf-8");</span></span><br><span class="line"><span class="comment">//            return originalString;</span></span><br><span class="line"><span class="comment">//        &#125; catch (Exception ex) &#123;</span></span><br><span class="line"><span class="comment">//            return null;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/开发/">开发</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/05/24/旧手机短信转发的解决方案（三）服务器端/" data-tooltip="旧手机短信转发的解决方案（三）服务器端" aria-label="PREVIOUS: 旧手机短信转发的解决方案（三）服务器端">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/05/22/旧手机短信转发的解决方案（一）概述/" data-tooltip="旧手机短信转发的解决方案（一）概述" aria-label="NEXT: 旧手机短信转发的解决方案（一）概述">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/" title="Share on Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/" title="Share on Weibo">
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/&amp;title=旧手机短信转发的解决方案（二）Android端" title="Share on QQ">
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>





                

                
                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
		Copyrights &copy; 2020 AndrewWang. All Rights Reserved.
    </span>
</footer>

                

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/05/24/旧手机短信转发的解决方案（三）服务器端/" data-tooltip="旧手机短信转发的解决方案（三）服务器端" aria-label="PREVIOUS: 旧手机短信转发的解决方案（三）服务器端">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/05/22/旧手机短信转发的解决方案（一）概述/" data-tooltip="旧手机短信转发的解决方案（一）概述" aria-label="NEXT: 旧手机短信转发的解决方案（一）概述">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/" title="Share on Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/" title="Share on Weibo">
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/&amp;title=旧手机短信转发的解决方案（二）Android端" title="Share on QQ">
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="2">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/">
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/">
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/">
                        <i class="fab fa-weibo" aria-hidden="true"></i><span>Share on Weibo</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://xiaoo.ml/2017/05/23/旧手机短信转发的解决方案（二）Android端/&amp;title=旧手机短信转发的解决方案（二）Android端">
                        <i class="fab fa-qq" aria-hidden="true"></i><span>Share on QQ</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/avatar(7).png" alt="Author&#39;s picture">
        
            <h4 id="about-card-name">AndrewWang</h4>
        
            <div id="about-card-bio"><p>凡是过去，皆为序章<br>须知参差百态，乃是幸福本源<br>邮箱：<a href="mailto:fernando_caudill@outlook.com" target="_blank">fernando_caudill@outlook.com</a></p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>Android+Python</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br>
                Zhangzhou Fujian
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/others/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search" class="form-control input--large search-input" placeholder="Search ">
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">no post found</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://xiaoo.ml/2013/01/22/Cloneable和clone的使用，以及深复制与浅复制的区别/">
                            <h3 class="media-heading">Cloneable和clone的使用，以及深复制与浅复制的区别</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 22, 2013
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><ni>深浅复制总结下</ni></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://xiaoo.ml/2013/02/04/Ubuntu Problem/">
                            <h3 class="media-heading">Ubuntu Problem</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Feb 4, 2013
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><ni>记录最近几年使用Ubuntu有用的Tips</ni></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://xiaoo.ml/2013/08/18/婚后，你一定会遇到更喜欢的人/">
                            <h3 class="media-heading">婚后，你一定会遇到更喜欢的人</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Aug 18, 2013
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>结婚后，你一定会遇到更喜欢的人。这件事几乎是肯定的。倒不是说先前结婚的人有多糟糕，也不是说后来出现的人有多美好。而是，你更了解自己了。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://xiaoo.ml/2013/11/09/ImageLoader must be init with configuration before using 错误解决方法/">
                            <h3 class="media-heading">ImageLoader must be init with configuration before using 错误解决方法</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Nov 9, 2013
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>最近开发过程中用到了开源项目Android-Universal-Image-Loader。<br></p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://xiaoo.ml/2013/12/14/把WordPress放在根目录而地址显示子目录的方法/">
                            <h3 class="media-heading">把WordPress放在根目录而地址显示子目录的方法</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Dec 14, 2013
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p> 今天在狗爹（GoDaddy）随便买了个域名，想建个个人博客耍耍。<br></p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://xiaoo.ml/2014/02/15/越是聪明人，越容易在这件事上栽跟头/">
                            <h3 class="media-heading">越是聪明人，越容易在这件事上栽跟头zt</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Feb 15, 2014
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>一篇名为《李开复：聪明人创业为何容易失败》的商业报道里写道，记者问李开复，如何在短时间内对一个创业者或项目进行判断，有哪些指标或者投资方法论？<br></p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://xiaoo.ml/2014/04/02/Java中普通代码块，构造代码块，静态代码块区别及代码示例/">
                            <h3 class="media-heading">Java中普通代码块，构造代码块，静态代码块区别及代码示例</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Apr 2, 2014
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>执行顺序：（优先级从高到低）静态代码块&gt;main方法&gt;构造代码块&gt;构造方法。其中静态代码块只执行一次。构造代码块在每次创建对象是都会执行。<br></p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://xiaoo.ml/2014/04/14/getApplicationContext()、getBasecontext()、getApplication() 区别/">
                            <h3 class="media-heading">getApplicationContext()、getBasecontext()、getApplication() 区别</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Apr 14, 2014
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><ni>搞清区别联系很重要，虽然好多情况下能通用的。</ni></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://xiaoo.ml/2014/04/24/使用注解来统计算法时间/">
                            <h3 class="media-heading">使用注解统计算法运行时间</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Apr 24, 2014
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>一直以为注解并没有什么卵用，后来用了butterknift和spring组件后才知道自定义组件可以完成很多任务。<br></p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://xiaoo.ml/2014/05/22/git merge和rebase的区别/">
                            <h3 class="media-heading">git merge和rebase的区别</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    May 22, 2014
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><ni>一直以来都以为rebase是合并冲突的一种手段，和merge一样的，用哪个都行。</ni></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium" data-message-zero="no post found" data-message-one="1 post found" data-message-other="{n} posts found">
                80 posts found
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/js/script-dbd16rvloemmuxdzniplmnxxvwoz24eya9wol0b7vvmlokgqsjivmb8dnscy.min.js"></script>
<!--SCRIPTS END-->

    


    <script src="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/js/moment-with-locales.min.js"></script>
    <script src="https://my-blog-hexo-1253240671.cos.ap-shanghai.myqcloud.com/js/algoliasearch.min.js"></script>
    <script>
        var algoliaClient = algoliasearch('NPCJXUJXHV', '519d0ecd5f05b733ac031d89154c7bbb');
        var algoliaIndex = algoliaClient.initIndex('my-hexo-blog');
    </script>


    </body>
</html>
